<% content_for :head do %>   
  <%= stylesheet_link_tag 'jquery.listbuilder.css' %>
  <%= javascript_include_tag 'jquery-ui-listbuilder' %>
  
  <script type="text/javascript">
  $(document).ready(function (){
  
    /* TABS */
    $("#tabs").tabs();
    showErrorTabs();

    /* DATEPICKER */ 	
  	$("#item_from").datetimepicker({
      changeYear: true
     });
  	$("#item_till").datetimepicker({
      changeYear: true
     });
     
    /* LOCATION */
    var address = $("#item_location_attributes_address").attr('value');
    var city =  $("#item_location_attributes_address").attr('value');
    $("#self_location:checkbox").click(function () {
      checked = $(this).attr('checked')
      if (!checked) {
        $("#item_location_attributes_address").attr('value','');
        $("#item_location_attributes_city").attr('value','');
        $("#item_location_attributes_country").find("option:first").attr('value','');
        $("#item_location_attributes_country").find("option:first").html('');
      }
    });
     
    /* AUTOCOMPLETE & LISTBUILDER */
    $( "#item_tag_list" ).listbuilder({autocomplete:{source: '/items/tag_suggestions.js'}});

 
    /* IMAGES */
    $('.image .file').hide();
    /*
    $('.image .options').hide();
    $('.image').hover(
      function () {
        $(this).find('.options').show();
      },
      function () {
        $(this).find('.options').hide();
      }
    );
    */
  
    /* ATTACHMENTS */
    $('.attachment .select').hide();
    
    /* Add Styles */
    $('.ui-listbuilder-input').addClass('ui-corner-all');
  
});


  

	</script>
<% end %>
<% semantic_form_for @item, :html => {:multipart => true} do |f| %>
  <%= f.error_messages %>
  <div id="tabs">
    <ul>
  		<li><a href="#what"><%= t("form.resource.what").html_safe %></a></li>
      <li><a href="#how_much"><%= t("form.resource.howMuch").html_safe %></a></li>
  		<li><a href="#location"><%= t("form.resource.where").html_safe %></a></li>
  		<li><a href="#when"><%= t("form.resource.when").html_safe %></a></li>
  		<li><a href="#images"><%= t("form.resource.images").html_safe %></a></li>
  		<li><a href="#attachments"><%= t("form.resource.attachments").html_safe %></a></li>
  	</ul>
  	<div id="what" class="tab_content ">
    <%= f.inputs do %>
      <%= f.input :user_id, :as => :hidden, :required => false, :value => current_user.id %>
      <%= f.input :need, :as => :select, :label => t("form.resource.i"), :include_blank => false, :collection => [[t("form.resource.need"), true], [t("form.resource.have"), false]] %>
      <%= f.input :item_type_id, :as => :select, :label => t("form.resource.a"), :collection => @itemTypes, :include_blank => true %>
      <%= f.input :multiple, :required => false %>
      <hr class="divider" />
      <li><%= f.input :title %></li>
      <li id="item_tag_list_input">
       <%= f.input :tag_list, :required => false %>
      </li>
      <%= f.input :description, :required => false %>
      <hr class="divider" />     
    <% end %>
    </div> 
    <div id="how_much" class="tab_content">
      <%= f.inputs do %>
        <%= f.input :amount, :required => false, :input_html => {:class => "short"}, :as => :numeric %>
        <%= f.semantic_fields_for :measure do |measure_form| %>
          <%= measure_form.input :measure, :collection => @measures, :required => false %>
        <% end %>
        <hr class="divider" />
      <% end %>
    </div>
    <div id="location">
      <%= render :partial => "locations/nested_form", :locals => { :f => f, :belongs_to => "item" } %>
      <hr class="divider" />
    </div>
    <div id="when" class="tab_content">
       <%= f.inputs do %>
        <%= render :partial => "events/nested_form", :locals => { :f => f, :belongs_to => "meetup" } %>
       <% end %>                                                                                       
      <hr class="divider" />
     </div>
    <div id="images" class="tab_content">
    <%= f.inputs do %>
      <% c = -1 %>
      <li>
        <div class="button new">
          <%= link_to_add_fields t("images.new").html_safe, f, :images %>
        </div>
      </li> 
      <% f.semantic_fields_for :images do |image_form| %>
        <%  c+= 1
          image = nil || @item.images[c].image if !@item.images[c].image.url.include? "missing"
        %>
        <div class="image center ui-corner-all">
          <%= link_to image_tag(image.url("small")), image.url("big") if image %>
          <%# render 'share/image_fields', :f => image_form %>
          <div class="options">
            <%= link_to_function image_tag(("icons/icon_image_edit.png"), :alt => t("edit"), :title => t("edit")), "edit_field(this)" if c < @item.images.count %>
            <%= link_to_remove_fields image_tag(("icons/icon_image_remove.png"), :alt => t("remove"), :title => t("remove")), image_form if c < @item.images.count %>
          </div>
        </div>
      <% end %>
    <% end %>  
      <hr class="divider" />
    </div>
    <div id="attachments" class="tab_content"> 
      <%= f.inputs do %>  
        <% d = -1 %>  
        <li><div class="button new">
           <%= link_to_add_fields t("item_attachments.new").html_safe, f, :item_attachments %>
          </div>
        </li>  
        <% f.semantic_fields_for :item_attachments do |attachment_form| %>
          <% 
            d += 1
            if @item.item_attachments and d < @item.item_attachments.count
              item = Item.find(@item.item_attachments[d].attachment_id) if @item.item_attachments[d].attachment_id
          %>
            <% if item %>
              <div class="attachment">  
                <p class="attached_item"><%= (image_tag(item.images.first.image.url("small"), :title => item.title, :alt => item.title)) || item.title %></p>
                <%= render 'item_attachment_fields', :f => attachment_form %>
                <div class="options">
                 <%= link_to_function image_tag(("icons/icon_folder_edit.png"), :alt => t("edit"), :title => t("edit")), "edit_field(this)" %> 
                 <%= link_to_remove_fields image_tag(("icons/icon_folder_remove.png"), :alt => t("remove").html_safe, :title => t("remove").html_safe), attachment_form %> 
                </div>
              </div>     
            <% end %>
          <% end %>
        <% end %>
      <% end %>  
       <hr class="divider" />
  </div>
  <% f.buttons do %>
    <%= f.commit_button :label => t("save") %>
  <% end %>
  </div>  
<% end %>